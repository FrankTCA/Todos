<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body {
            font-family: sans;
            background-color: #12121f;
            color: white;
        }
        .task {
            padding: 10px;
            border: 5px solid #d9a2f5;
            background-color: #190424;
            color: white;
            min-width: 50%;
            margin: 0;
        }

        .task:hover:not(:has(.task:hover)) {
            padding: 10px;
            border: 5px solid #d9a2f5;
            background-color: #361b45;
            color: white;
            min-width: 50%;
            margin: 0;
        .task_list {
            list-style-type: none;
            padding-left: 0;
        }
    </style>
</head>
<body>
    <script>
        var global_task = {
            name: "global_task",
            desc: "",
            subtasks: [],
            completed: false,
        };

        function get_task_from_id(id) {
            var indices = id.split(":");
            var task = global_task;
            for (var i = 1; i < indices.length; i++) {
                task = task.subtasks[Number(indices[i])];
            }

            return task;
        }

        function display_task(task, id) {
            var task_element = document.getElementById(id + "_subtasks");
            task_element.innerHTML = "";

            for (var i = 0; i < task.subtasks.length; i++) {
                task_element.appendChild(document.createElement("br"));
                var new_li = document.createElement("li");
                new_li.id = id + ":" + i;

                var new_div = document.createElement("div");
                new_div.setAttribute("class", "task");

                var name_header = document.createElement("h3");
                if (task.subtasks[i].completed) {
                    var strike_through = document.createElement("strike");
                    strike_through.innerHTML = task.subtasks[i].name;
                    name_header.appendChild(strike_through);
                }
                else {
                    name_header.innerHTML = task.subtasks[i].name;
                }
                new_div.appendChild(name_header);
    
                var completion_checkbox = document.createElement("input");
                completion_checkbox.type = "checkbox";
                completion_checkbox.setAttribute("onclick", "toggle_completion('" + id + "', '" + i + "')");
                completion_checkbox.checked = task.subtasks[i].completed;
                new_div.appendChild(completion_checkbox);
    
                var desc_par = document.createElement("p");
                desc_par.innerHTML = task.subtasks[i].desc;
                new_div.appendChild(desc_par);
    
                var remove_button = document.createElement("input");
                remove_button.type = "button";
                remove_button.value = "Remove";
                remove_button.setAttribute("onclick", "remove_task('" + id + "', '" + i + "')");
                new_div.appendChild(remove_button);

                task_element.appendChild(new_li);

                if (task.subtasks[i].subtasks.length > 0) {
                    var new_list = document.createElement("ul");
                    new_list.id = new_li.id + "_subtasks";
                    new_list.class = "task_list";
                    new_div.appendChild(new_list);

                    new_li.appendChild(new_div);

                    display_task(task.subtasks[i], new_li.id);
                }
                else {
                    new_li.appendChild(new_div);
                    task_element.appendChild(new_li);
                }
            }
        }

        function add_task() {
            var id = document.getElementById("set_parent_task").value;
            var task = get_task_from_id(id);

            task.subtasks.push({
                name: document.getElementById("add_name").value,
                desc: document.getElementById("add_desc").value,
                completed: false,
                subtasks: [],
            });

            display_task(global_task, "global_task");
        }

        function remove_task(parent_id, i) {
            var task = get_task_from_id(parent_id);
            task.subtasks.splice(i, 1);
            display_task(task, parent_id);
        }

        function toggle_completion(parent_id, i) {
            var task = get_task_from_id(parent_id);
            task.subtasks[i].completed = !task.subtasks[i].completed;
            display_task(task, parent_id);
        }
    </script>

    <label for="add_name">Name:</label><br>
    <input type="text" id="add_name"><br>
    <label for="add_name">Description:</label><br>
    <input type="text" id="add_desc"><br>
    <label for="set_parent_task">Parent task:</label><br>
    <input type="text" id="set_parent_task"><br>
    <input type="button" id="add_task" value="Add" onclick="add_task()"><br>

    <ul id="global_task_subtasks" class="task_list">
    </ul>
</body>
</html>
